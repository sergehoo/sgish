{% extends 'layout/base.html' %}
{% load static %}
{% block content %}
    <div class="nk-content nk-content-fluid">
        <div class="container-xl wide-lg">
            <div class="nk-content-body">

                <div class="nk-block-head nk-block-head-sm ">
                    <div class="row rounded"
                         style="height: 200px;background-repeat: no-repeat; background-image: url('{% static 'images/consultation_banner1.png' %}')">
                        <div class="nk-block-between">
                            <div class="nk-block-head-content">
                                <h1 class="nk-block-title page-title ml-20" style="color: black; text-align: right">
                                    Consultation
                                    Patient</h1>
                                <div class="nk-block-des">
                                    <h2 class="ml-5"> {{ consultationsdupatient.patient }}</h2>
                                    <h6 class="ml-5">Code Patient: <span
                                            class="text-danger">{{ consultationsdupatient.patient.code_patient }}</span>
                                    </h6>
                                    <h6 class="ml-5">Code VIH: <span
                                            class="text-danger">{{ consultationsdupatient.patient.code_vih }}</span>
                                    </h6>
                                </div>
                            </div><!-- .nk-block-head-content -->

                        </div>
                    </div><!-- .nk-block-between -->

                    <div class="mt-2">
                        {% if consultationsdupatient.patient.latest_constante %}
                            <a href="#" data-toggle="modal" data-target="#constanteover"
                               class="btn btn-outline-primary mr-4"><em class="icon ni ni-note-add"></em>Constantes</a>
                        {% else %}
                            <a class="btn btn-outline-primary mr-4"
                               href="{% url 'ajouter_constantes' patient_id=consultationsdupatient.patient.id %}"><em
                                    class="fa fa-edit mr-1"></em><span> Ajouter une Constante</span></a>


                        {% endif %}
                        <div class="modal fade" tabindex="-1" id="constanteover">
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">
                                    <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                        <em class="icon ni ni-cross"></em>
                                    </a>
                                    <div class="modal-header">
                                        <h5 class="modal-title">Overview des constante du Patient : <span
                                                class="text-primary">{{ consultationsdupatient.patient.latest_constante }}</span>
                                        </h5>
                                    </div>
                                    <div class="modal-body">
                                        <div class="nk-block card card-bordered">

                                            {% if consultationsdupatient.patient.latest_constante %}
                                                <h4>Deniere constante enregistrée le
                                                    : {{ consultationsdupatient.patient.latest_constante.created_at }} </h4>
                                                <table class="table table-responsive">
                                                    <thead class="thead-light">
                                                    <tr>
                                                        <th class="tb-col-os"><span class="overline-title">Libélé <span
                                                                class="d-sm-none">/ IP</span></span>
                                                        </th>
                                                        <th class="tb-col-ip"><span
                                                                class="overline-title">Valeure</span></th>
                                                        <th class="tb-col-time"><span
                                                                class="overline-title">Observation</span></th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>


                                                    <tr>
                                                        <td class="tb-col-os">Tension systolique</td>
                                                        <td class="tb-col-ip">
                                                            <span class="sub-text">{{ consultationsdupatient.patient.latest_constante.tension_systolique }}</span>
                                                        </td>
                                                        <td class="tb-col-time">
                                                            {% if consultationsdupatient.patient.latest_constante.tension_systolique < 90 or consultationsdupatient.patient.latest_constante.tension_systolique > 140 %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Tension artérielle systolique anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle systolique est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Tension diastolique</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.tension_diastolique }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.tension_diastolique < 60 or consultationsdupatient.patient.latest_constante.tension_diastolique > 90 %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Tension artérielle diastolique est anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle diastolique est dans le seuil normale</span>
                                                            {% endif %}</td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Frequence cardiaque</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.frequence_cardiaque }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.frequence_cardiaque < 60 or consultationsdupatient.patient.latest_constante.frequence_cardiaque > 100 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Fréquence cardiaque anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Fréquence cardiaque est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Frequence respiratoire</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.frequence_respiratoire }}</span>
                                                        </td>
                                                        <td class="tb-col-time">
                                                            {% if consultationsdupatient.patient.latest_constante.frequence_respiratoire < 12 or consultationsdupatient.patient.latest_constante.frequence_respiratoire  > 20 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Fréquence respiratoire anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Fréquence respiratoire est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Temperature</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.temperature }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.temperature < 36 or consultationsdupatient.patient.latest_constante.temperature > 37.5 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Température anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La température est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Saturation oxygene</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.saturation_oxygene }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.saturation_oxygene < 95 or consultationsdupatient.patient.latest_constante.saturation_oxygene > 100 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Saturation oxygene anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Saturation oxygene est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">Glycemie</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.glycemie }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.glycemie < 70 or consultationsdupatient.patient.latest_constante.glycemie > 140 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation text-danger"></i>Glycemie anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Glycemie est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">poids</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.poids }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.tension_systolique < 90 or consultationsdupatient.patient.latest_constante.tension_systolique > 140 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation"></i>Tension artérielle systolique anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle systolique est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">taille</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.taille }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.tension_systolique < 90 or consultationsdupatient.patient.latest_constante.tension_systolique > 140 %}
                                                                <span class="sub-text"><i class="fa fa-warning"></i>Tension artérielle systolique anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle systolique est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">pouls</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.pouls }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.tension_systolique < 90 or consultationsdupatient.patient.latest_constante.tension_systolique > 140 %}
                                                                <span class="sub-text"><i class="fa fa-warning"></i>Tension artérielle systolique anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle systolique est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    <tr>
                                                        <td class="tb-col-os">IMC</td>
                                                        <td class="tb-col-ip"><span
                                                                class="sub-text">{{ consultationsdupatient.patient.latest_constante.imc }}</span>
                                                        </td>
                                                        <td class="tb-col-time">

                                                            {% if consultationsdupatient.patient.latest_constante.tension_systolique < 90 or consultationsdupatient.patient.latest_constante.tension_systolique > 140 %}
                                                                <span class="sub-text"><i
                                                                        class="fa-solid fa-circle-exclamation"></i>Tension artérielle systolique anormale</span>
                                                            {% else %}
                                                                <span class="sub-text font-italic"><i
                                                                        class="fa-solid fa-thumbs-up text-primary"></i> La Tension artérielle systolique est dans le seuil normale</span>
                                                            {% endif %}
                                                        </td>

                                                    </tr>
                                                    </tbody>
                                                </table>

                                            {% else %}
                                                Pas de constantes enregistrées
                                            {% endif %}
                                        </div>


                                    </div>
                                    <div class="modal-footer bg-light">
                                        <span class="sub-text">Prise de tension {{ patient.patient }} {{ consultationsdupatient.patient.code_patient }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <a href="{% url 'detail_patient' consultationsdupatient.patient.pk %}"
                           class="btn btn-outline-primary mr-4"><em class="icon ni ni-folder"></em>Dossier</a>
                        <a href="" data-toggle="modal" data-target="#hospitalisationreq"
                           class="btn btn-outline-danger float-right mr-5"> <i class="fa-solid fa-bed-pulse mr-1"></i>
                            Hospitalisation </a>

                        <!-- Modal Content Code -->
                        <div class="modal fade" tabindex="-1" id="hospitalisationreq">
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content ">
                                    <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                        <em class="icon ni ni-cross"></em>
                                    </a>
                                    <div class="modal-header">
                                        <h5 class="modal-title">Hospitalisation Patients
                                            {{ consultationsdupatient.patient }}</h5>
                                    </div>
                                    <form action="{% url 'mark_hospitalisation' consultation_id=consultationsdupatient.id patient_id=consultationsdupatient.patient.id %}"
                                          method="POST" enctype="application/x-www-form-urlencoded">
                                        {% csrf_token %}
                                        <div class="modal-body">

                                            {{ hospit_request }}
                                        </div>
                                        <div class="modal-footer bg-light ">
                                            <span class="sub-text">Hospitalisation Patient {{ consultationsdupatient.patient.code_patient }}</span>
                                            <div class="col-lg-3 float-right">
                                                <button class="btn btn-primary" type="submit">Envoyer</button>
                                            </div>


                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <a href="{% url 'mark_hospitalisation' consultation_id=consultationsdupatient.id patient_id=consultationsdupatient.patient.id %}"
                           class="btn btn-outline-secondary float-right mr-5"
                           onclick="return confirm('Êtes-vous sûr de vouloir hospitaliser ce patient ?');"><em
                                class="icon ni ni-reply-fill"></em> Bilan Initial VIH </a>


                    </div>


                </div><!-- .nk-block-head -->

                <div class="nk-block">
                    <div class="card card-bordered card-stretch">
                        <div class="card-inner-group">
                            <blockquote class="blockquote text-center">
                                <p class="mb-0">Motif de consultation du <strong
                                        class="text-primary">{{ consultationsdupatient.created_at }}</strong>:</p>
                                <footer class="blockquote-footer">Motif : {{ consultationsdupatient.reason }}</footer>
                            </blockquote>
                            <hr>
                            <div class="row m-4">
                                <div class=" col-9 position-relative">
                                    <h3 class="text-muted">Consultation Général Patient</h3>

                                </div>
                                <div class="col-2 position-relative">

                                    <a href="#" class="btn btn-outline-lighter" style="right: 0; top: 0; left: 100%">
                                        <em class="icon ni ni-printer"></em> Imprimer
                                    </a>
                                </div>
                                <div class="row col-12 mt-5">
                                    <div class="col-6 col-md-6 mb-5">
                                        <div class="card text-black-100 border">
                                            <div class="card-header">Test Rapide de dépistage
                                                <button type="button"
                                                        class="btn btn-dark float-right  btn-icon btn-round"
                                                        data-toggle="modal"
                                                        data-target="#testdepistage"><em
                                                        class="icon ni ni-plus-circle-fill"></em></button>
                                            </div>
                                            <div class="card-inner text-black-70">
                                                <table class="table">
                                                    <thead>
                                                    <th>Date</th>
                                                    <th>Type</th>
                                                    <th>Resultat</th>
                                                    <th>Action</th>
                                                    </thead>
                                                    <tbody>
                                                    {% for test in consultationsdupatient.tests_for_consultation_vih.all %}
                                                        <tr>
                                                            <td>{{ test.date_test }}</td>
                                                            <td>{{ test.test_type }}</td>

                                                            <td>
                                                                {% if test.resultat == 'NEGATIF' %}
                                                                    <span class="badge badge-success">{{ test.resultat }}</span>
                                                                {% else %}
                                                                    <span class="badge badge-danger">{{ test.resultat }}</span>
                                                                {% endif %}

                                                            </td>
                                                            <td>
                                                                <a class="btn btn-outline-danger  btn-icon btn-round btn-xs mr-1"
                                                                   href="{% url 'delete_test_rapide_generale' test_id=test.id consultation_id=consultationsdupatient.id %}"><em
                                                                        class="icon ni ni-trash  "></em></a>
                                                                <a class="btn btn-outline-info  btn-icon btn-round btn-xs mr-1"
                                                                   href=""><em class="icon ni ni-download-cloud "></em></a>

                                                            </td>


                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-6 mb-5">
                                        <div class="card text-black-100 border">

                                            <div class="card-header">Symptomes
                                                <button type="button"
                                                        class="btn btn-dark float-right ml-5   btn-icon btn-round"
                                                        data-toggle="modal" data-target="#symptomes"><em
                                                        class="icon ni ni-plus-circle-fill"></em></button>
                                            </div>
                                            <div class="card-inner text-black-70">
                                                <table class="table ">
                                                    <th>Titre</th>
                                                    <th style="text-align: right">Date de debut</th>
                                                    <th style="text-align: right">Action</th>
                                                    {% for symptome in consultationsdupatient.symptomes.all %}
                                                        <tr>
                                                            <td>{{ symptome.nom }}</td>
                                                            <td style="text-align: right">{{ symptome.date_debut }}</td>
                                                            <td style="text-align: right">
                                                                <a href="{% url 'symptome_delete' symp=symptome.id consultation_id=consultationsdupatient.id %}"
                                                                   class="btn btn-outline-light btn-xs"><i
                                                                        class="fa-solid fa-trash-alt"></i></a>
                                                            </td>
                                                        </tr>
                                                    {% empty %}
                                                        <tr>
                                                            <td style="font-style: italic; text-align: center"
                                                                class="text-white"> Aucune donnée enregistrée
                                                            </td>
                                                        </tr>

                                                    {% endfor %}
                                                </table>
                                            </div>

                                        </div>
                                    </div>

                                </div>


                                <div class="row col-12">
                                    <div class="col-6 col-md-6 mb-5">
                                        <div class="card text-black-100 border">

                                            <div class="card-header">Examens
                                                <button type="button"
                                                        class="btn btn-dark  btn-icon btn-round float-right"
                                                        data-toggle="modal" data-target="#rendezvous"><em
                                                        class="icon ni ni-plus-circle-fill"></em></button>
                                            </div>
                                            <div class="card-inner text-black-70">
                                                <table class="table">
                                                    <thead>
                                                    <th>Titre</th>
                                                    <th>Date</th>
                                                    <th>Statut</th>
                                                    <th>Action</th>
                                                    </thead>
                                                    <tbody>
                                                    {% for examen in consultationsdupatient.examen_for_consultation.all %}
                                                        <tr>
                                                            {#                                             {% for analyse in examen.analyses.all %}#}
                                                            {#                                                <td>analyse1</td>#}
                                                            {##}
                                                            {##}
                                                            {#                                                <td><a class="btn btn-outline-info  btn-icon btn-round mr-5"  href="{% url 'telecharger_consultations' patient_id=consultationsdupatient.patient.id consultation_id=consultationsdupatient.id %}"><em class="icon ni ni-download-cloud ml-10 "></em></a></td>#}
                                                            {#                                             {% endfor %}#}

                                                            <td>{{ examen.analyses }}</td>
                                                            <td>{{ examen.created_at }}</td>
                                                            <td>status</td>
                                                            <td>
                                                                <a class="btn btn-outline-danger  btn-icon btn-round mr-5"
                                                                   href="{% url 'Examens_delete' examen_id=examen.id consultation_id=consultationsdupatient.id %}"><em
                                                                        class="icon ni ni-trash ml-10 "></em></a>
                                                            </td>

                                                        </tr>
                                                    {% endfor %}

                                                    </tbody>

                                                </table>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="col-6 col-md-6 mb-5">
                                        <div class="card text-black-100 border">
                                            <div class="card-header">Prélèvement

                                                <button type="button"
                                                        class="btn btn-dark  btn-icon btn-round float-right"
                                                        data-toggle="modal" data-target="#diagnosis"><em
                                                        class="icon ni ni-plus-circle-fill"></em></button>
                                            </div>
                                            <div class="card-inner text-black-70">
                                                <table class="table">
                                                    <thead>
                                                    <th>Code</th>
                                                    <th>Type</th>
                                                    <th>Date</th>
                                                    <th>Statut</th>
                                                    <th>Action</th>
                                                    </thead>
                                                    <tbody>
                                                    {% for preleve in consultationsdupatient.echantillon_for_consultation.all %}
                                                        <tr>
                                                            <td>{{ preleve.code_echantillon }}</td>
                                                            <td>{{ preleve.type }}</td>
                                                            <td>{{ preleve.created_at }}</td>
                                                            <td>{{ preleve.status_echantillons }}</td>
                                                            <td>
                                                                <a class="btn btn-outline-danger  btn-icon btn-round mr-5"
                                                                   href="{% url 'delete_echantillon_consultation_generale' echantillon_id=preleve.id consultation_id=consultationsdupatient.id %}"><em
                                                                        class="icon ni ni-trash ml-10 "></em></a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>


                                <div class="modal fade" tabindex="-1" id="testdepistage">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title"> Depistage rapide</h5>
                                            </div>
                                            <form method="post"
                                                  action="{% url 'test_depistage_generale_create' consultation_id=consultationsdupatient.id %}">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    <div id="fiagnosique">
                                                        {% for form in depistage_form %}
                                                            <div class="row">
                                                                <div class="col-lg-12 col-sm-12 mb-3">
                                                                    <div class="form-group">
                                                                        {{ form.label }}
                                                                        {{ form }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>

                                                </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal fade" tabindex="-1" id="diagnosis">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Prélèvements</h5>
                                            </div>
                                            <form method="post"
                                                  action="{% url 'create_echantillon_consultation_generale' consultation_id=consultationsdupatient.id %}">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    <div id="fiagnosique">
                                                        {% for form in prelevement_form %}
                                                            <div class="row">
                                                                <div class="col-lg-12 col-sm-12 mb-3">
                                                                    <div class="form-group">
                                                                        {{ form.label }}
                                                                        {{ form }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>
                                                    <button type="button" id="add-symptome" class="btn btn-secondary">
                                                        Ajouter <i class="fa-solid fa-plus-circle fa-lg ml-5"> </i>
                                                    </button>
                                                </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal fade" tabindex="-1" id="symptomes">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Symptômes</h5>
                                            </div>
                                            <form method="post"
                                                  action="{% url 'create_symptomes' consultation_id=consultationsdupatient.id %}">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    <div id="symptomes-forms">
                                                        {% for form in symptomes_forms %}
                                                            <div class="row">
                                                                <div class="col-lg-6 col-sm-12 mb-3">
                                                                    <div class="form-group">
                                                                        <label class="form-label"
                                                                               for="nom_{{ form.prefix }}">{{ form.nom.label }}</label>
                                                                        <input type="text" name="nom[]" maxlength="255"
                                                                               class="form-control form-control-lg"
                                                                               required
                                                                               id="id_symptomes-${formIdx}-nom">
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6 col-sm-12 mb-3">
                                                                    <div class="form-group">
                                                                        <label class="form-label"
                                                                               for="date_debut_{{ form.prefix }}">{{ form.date_debut.label }}</label>
                                                                        <input type="date" name="date_debut[]"
                                                                               class="form-control form-control-lg"
                                                                               required
                                                                               id="id_symptomes-${formIdx}-date_debut">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        {% endfor %}
                                                    </div>

                                                </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal fade" tabindex="-1" id="Antecedents">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <a href="{% url 'Antecedents_create' consultation_id=consultationsdupatient.id %}"
                                               class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Enquete VIH </h5>
                                            </div>
                                            <form action="{% url 'enquete_create' consultation_id=consultationsdupatient.id %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    <div class="row">
                                                        <div class="form-group col-3">
                                                            {{ EnqueteVihForm.antecedents.label_tag }}
                                                            {{ EnqueteVihForm.antecedents }}
                                                        </div>

                                                        <div class="form-group col-3">
                                                            {{ EnqueteVihForm.evolutif_cdc_1993.label_tag }}
                                                            {{ EnqueteVihForm.evolutif_cdc_1993 }}
                                                        </div>
                                                        <div class="form-group col-3">
                                                            {{ EnqueteVihForm.infection_opportuniste.label_tag }}
                                                            {{ EnqueteVihForm.infection_opportuniste }}
                                                        </div>
                                                        <div class="form-group">
                                                            {{ EnqueteVihForm.score_karnofsky.label_tag }}
                                                            {{ EnqueteVihForm.score_karnofsky }}
                                                        </div>

                                                        <div class="form-group col-2">
                                                            {{ EnqueteVihForm.prophylaxie_antiretrovirale.label_tag }}
                                                            {{ EnqueteVihForm.prophylaxie_antiretrovirale }}
                                                        </div>


                                                        <div class="form-group col-10">
                                                            {{ EnqueteVihForm.prophylaxie_type.label_tag }}
                                                            {{ EnqueteVihForm.prophylaxie_type }}
                                                        </div>


                                                        <div class="form-group col-2">
                                                            {{ EnqueteVihForm.traitement_antiretrovirale.label_tag }}
                                                            {{ EnqueteVihForm.traitement_antiretrovirale }}
                                                        </div>


                                                        <div class="form-group col-10">
                                                            {{ EnqueteVihForm.traitement_type.label_tag }}
                                                            {{ EnqueteVihForm.traitement_type }}
                                                        </div>


                                                        <div class="form-group col-2">
                                                            {{ EnqueteVihForm.dernier_regime_antiretrovirale.label_tag }}
                                                            {{ EnqueteVihForm.dernier_regime_antiretrovirale }}
                                                        </div>


                                                        <div class="form-group col-10">
                                                            {{ EnqueteVihForm.dernier_regime_antiretrovirale_type.label_tag }}
                                                            {{ EnqueteVihForm.dernier_regime_antiretrovirale_type }}
                                                        </div>

                                                        <div class="form-group col-2">
                                                            {{ EnqueteVihForm.traitement_prophylactique_cotrimoxazole.label_tag }}
                                                            {{ EnqueteVihForm.traitement_prophylactique_cotrimoxazole }}
                                                        </div>


                                                        <div class="form-group col-2">
                                                            {{ EnqueteVihForm.sous_traitement.label_tag }}
                                                            {{ EnqueteVihForm.sous_traitement }}
                                                        </div>


                                                        {#        {% for field in EnqueteVihForm %}#}
                                                        {#            <div class="col-6">#}
                                                        {#                <div class="form-group">#}
                                                        {#                    {{ field.label_tag }}#}
                                                        {#                    {{ field }}#}
                                                        {#                    {% if field.help_text %}#}
                                                        {#                        <small class="form-text text-muted">{{ field.help_text }}</small>#}
                                                        {#                    {% endif %}#}
                                                        {#                    {% if field.errors %}#}
                                                        {#                        <div class="text-danger">#}
                                                        {#                            {{ field.errors }}#}
                                                        {#                        </div>#}
                                                        {#                    {% endif %}#}
                                                        {#                </div>#}
                                                        {#            </div>#}
                                                        {#        {% endfor %}#}


                                                    </div>
                                                </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"></i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right">
                                                            <i class="fa-solid fa-floppy-disk"></i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" tabindex="-1" id="Allergies">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Allergies</h5>
                                            </div>
                                            <form action="{% url 'Allergies_create' consultation_id=consultationsdupatient.id %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    {{ allergies_form }}            </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {#                                <div class="modal fade" tabindex="-1" id="Examens">#}
                                {#                                    <div class="modal-dialog" role="document">#}
                                {#                                        <div class="modal-content">#}
                                {#                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">#}
                                {#                                                <em class="icon ni ni-cross"></em>#}
                                {#                                            </a>#}
                                {#                                            <div class="modal-header">#}
                                {#                                                <h5 class="modal-title">Examen physique</h5>#}
                                {#                                            </div>#}
                                {##}
                                {#                                            <form action="{% url 'Examens_create' consultation_id=consultationsdupatient.id %}"#}
                                {#                                                  method="post">#}
                                {#                                                {% csrf_token %}#}
                                {#                                                <div class="modal-body">#}
                                {#                                                    {{ examen_form }}            </div>#}
                                {#                                                <div class="modal-footer bg-light">#}
                                {#                                                    <div class="col-md-12 float-right mb-10">#}
                                {#                                                        <button type="submit" class="btn btn-primary mb-10 float-right">#}
                                {#                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer#}
                                {#                                                        </button>#}
                                {#                                                        <button type="reset"#}
                                {#                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i#}
                                {#                                                                class="fa-solid fa-floppy-disk"> </i> Annuler#}
                                {#                                                        </button>#}
                                {#                                                    </div>#}
                                {#                                                </div>#}
                                {#                                            </form>#}
                                {#                                        </div>#}
                                {#                                    </div>#}
                                {#                                </div>#}
                                <div class="modal fade" tabindex="-1" id="conseils">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Conseeils</h5>
                                            </div>

                                            <form action="{% url 'Allergies_create' consultation_id=consultationsdupatient.id %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    {{ conseils_form }}           </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" tabindex="-1" id="rendezvous">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Examens</h5>
                                            </div>

                                            <form action="{% url 'Examens_generale_create' consultation_id=consultationsdupatient.id %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    {{ examen_form }}            </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" tabindex="-1" id="protocoles">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                <em class="icon ni ni-cross"></em>
                                            </a>
                                            <div class="modal-header">
                                                <h5 class="modal-title">Protocole</h5>
                                            </div>
                                            <form action="{% url 'Allergies_create' consultation_id=consultationsdupatient.id %}"
                                                  method="post">
                                                {% csrf_token %}
                                                <div class="modal-body">
                                                    {{ conseils_form }}           </div>
                                                <div class="modal-footer bg-light">
                                                    <div class="col-md-12 float-right mb-10">
                                                        <button type="submit" class="btn btn-primary mb-10 float-right">
                                                            <i class="fa-solid fa-floppy-disk"> </i> Enregistrer
                                                        </button>
                                                        <button type="reset"
                                                                class="btn btn-secondary mb-10 mr-5 float-right"><i
                                                                class="fa-solid fa-floppy-disk"> </i> Annuler
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div><!-- .card-inner-group -->
                    </div><!-- .card -->
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let formIdx = {{ symptomes_forms|length }};
            document.getElementById('add-symptome').addEventListener('click', function () {
                const newForm = document.createElement('div');
                newForm.className = 'row';
                const formHtml = `<div class="col-lg-6 col-sm-12 mb-3">
<div class="form-group">
<label class="form-label" for="id_symptomes-${formIdx}-nom">Nom</label>
<input type="text" name="nom[]" maxlength="255" class="form-control form-control-lg" required id="id_symptomes-${formIdx}-nom">
</div>
                              </div>
                              <div class="col-lg-6 col-sm-12 mb-3">
                                <div class="form-group">
                                    <label class="form-label" for="id_symptomes-${formIdx}-date_debut">Date début</label>
                                    <input type="date" name="date_debut[]" class="form-control form-control-lg" required id="id_symptomes-${formIdx}-date_debut">
                                </div>
                              </div>`;
                newForm.innerHTML = formHtml;
                document.getElementById('symptomes-forms').appendChild(newForm);
                formIdx++;
            });
        });
    </script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            var booleanTypePairs = [
                {checkbox: 'prophylaxie_antiretrovirale', typeField: 'prophylaxie_type'},
                {checkbox: 'traitement_antiretrovirale', typeField: 'traitement_type'},
                {checkbox: 'dernier_regime_antiretrovirale', typeField: 'dernier_regime_antiretrovirale_type'},
                {
                    checkbox: 'traitement_prophylactique_cotrimoxazole',
                    typeField: 'traitement_prophylactique_cotrimoxazole_type'
                },
            ];

            function toggleTypeField(checkboxId, typeFieldId) {
                var checkbox = document.getElementById(checkboxId);
                var typeField = document.getElementById(typeFieldId);

                if (checkbox && typeField) {
                    if (checkbox.checked) {
                        typeField.closest('.form-group').style.display = 'block';
                    } else {
                        typeField.closest('.form-group').style.display = 'none';
                    }
                }
            }

            booleanTypePairs.forEach(function (pair) {
                toggleTypeField(pair.checkbox, pair.typeField);

                document.getElementById(pair.checkbox).addEventListener('change', function () {
                    toggleTypeField(pair.checkbox, pair.typeField);
                });
            });
        });
    </script>
{% endblock %}