{% extends 'layout/base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<style>
    :root {
        --primary-color: #4a6cf7;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
        --gradient-primary: linear-gradient(135deg, #4a6cf7 0%, #6a11cb 100%);
        --gradient-success: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        --gradient-danger: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
        --gradient-warning: linear-gradient(135deg, #ffc107 0%, #ff6b6b 100%);
        --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.07);
        --shadow-medium: 0 10px 25px rgba(0, 0, 0, 0.1);
        --shadow-heavy: 0 20px 50px rgba(0, 0, 0, 0.15);
    }

    /* Animations améliorées */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInLeft {
        from {
            transform: translateX(-30px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes bounceIn {
        0% {
            transform: scale(0.3);
            opacity: 0;
        }
        50% {
            transform: scale(1.05);
        }
        70% {
            transform: scale(0.9);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }

    /* Styles globaux améliorés */
    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
        min-height: 100vh;
    }

    .patient-dashboard {
        animation: fadeInUp 0.8s ease-out;
    }

    /* En-tête du profil amélioré */
    .profile-header {
        background: var(--gradient-primary);
        border-radius: 20px;
        box-shadow: var(--shadow-heavy);
        animation: fadeInUp 0.8s ease-out;
        position: relative;
        overflow: hidden;
        margin-bottom: 2rem;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('{% static "images/medical-pattern.png" %}') center/cover;
        opacity: 0.1;
    }

    .qr-code-container {
        transition: all 0.4s ease;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        padding: 8px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
    }

    .qr-code-container:hover {
        transform: scale(1.1) rotate(5deg);
        border-color: rgba(255, 255, 255, 0.6);
        box-shadow: 0 15px 35px rgba(74, 108, 247, 0.4);
    }

    .patient-title {
        position: relative;
        padding-left: 20px;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .patient-title::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 6px;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 3px;
        animation: slideInLeft 1s ease-out;
    }

    /* Cartes améliorées */
    .medical-card {
        background: white;
        border: none;
        border-radius: 15px;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
        margin-bottom: 1.5rem;
        overflow: hidden;
    }

    .medical-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-medium);
    }

    .medical-card-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .medical-card-body {
        padding: 1.5rem;
    }

    /* Statistiques en temps réel */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
        border-left: 5px solid var(--primary-color);
    }

    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-medium);
    }

    .stat-card.consultations { border-left-color: var(--info-color); }
    .stat-card.hospitalizations { border-left-color: var(--warning-color); }
    .stat-card.appointments { border-left-color: var(--success-color); }
    .stat-card.prescriptions { border-left-color: var(--danger-color); }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-label {
        color: var(--secondary-color);
        font-weight: 600;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Onglets améliorés */
    .nav-tabs-modern {
        border: none;
        background: white;
        border-radius: 15px;
        padding: 0.5rem;
        box-shadow: var(--shadow-light);
        margin-bottom: 2rem;
    }

    .nav-tabs-modern .nav-link {
        border: none;
        color: var(--secondary-color);
        font-weight: 600;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        transition: all 0.3s ease;
        position: relative;
        margin: 0 0.25rem;
    }

    .nav-tabs-modern .nav-link:hover {
        color: var(--primary-color);
        background: rgba(74, 108, 247, 0.05);
        transform: translateY(-2px);
    }

    .nav-tabs-modern .nav-link.active {
        color: white;
        background: var(--gradient-primary);
        box-shadow: var(--shadow-light);
    }

    .nav-tabs-modern .nav-link .badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger-color);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Contenu des onglets */
    .tab-content-modern {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow-light);
        overflow: hidden;
    }

    .tab-pane-modern {
        padding: 2rem;
        animation: fadeInUp 0.5s ease-out;
    }

    /* Accordéon amélioré */
    .accordion-modern {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
    }

    .accordion-item-modern {
        border: none;
        margin-bottom: 1rem;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        transition: all 0.3s ease;
    }

    .accordion-item-modern:hover {
        box-shadow: var(--shadow-medium);
    }

    .accordion-header-modern {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: none;
    }

    .accordion-button-modern {
        background: none;
        border: none;
        padding: 1.5rem;
        color: var(--dark-color);
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .accordion-button-modern:not(.collapsed) {
        color: var(--primary-color);
        background: rgba(74, 108, 247, 0.05);
    }

    .accordion-button-modern::after {
        transform: rotate(0deg);
        transition: transform 0.3s ease;
    }

    .accordion-button-modern:not(.collapsed)::after {
        transform: rotate(180deg);
    }

    /* Tableaux améliorés */
    .table-modern {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
    }

    .table-modern thead th {
        background: var(--gradient-primary);
        color: white;
        border: none;
        padding: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.85rem;
    }

    .table-modern tbody tr {
        transition: all 0.3s ease;
    }

    .table-modern tbody tr:hover {
        background: rgba(74, 108, 247, 0.05);
        transform: scale(1.01);
    }

    /* Boutons améliorés */
    .btn-modern {
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s;
    }

    .btn-modern:hover::before {
        left: 100%;
    }

    .btn-primary-modern {
        background: var(--gradient-primary);
        box-shadow: 0 4px 15px rgba(74, 108, 247, 0.3);
    }

    .btn-primary-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(74, 108, 247, 0.4);
    }

    /* Timeline médicale */
    .medical-timeline {
        position: relative;
        padding-left: 2rem;
    }

    .medical-timeline::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--primary-color);
        border-radius: 2px;
    }

    .timeline-item {
        position: relative;
        margin-bottom: 2rem;
        padding-left: 2rem;
        animation: fadeInUp 0.5s ease-out;
    }

    .timeline-item::before {
        content: '';
        position: absolute;
        left: -0.75rem;
        top: 0.5rem;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        background: var(--primary-color);
        border: 4px solid white;
        box-shadow: var(--shadow-light);
    }

    .timeline-item.consultation::before { background: var(--info-color); }
    .timeline-item.hospitalization::before { background: var(--warning-color); }
    .timeline-item.appointment::before { background: var(--success-color); }
    .timeline-item.prescription::before { background: var(--danger-color); }

    /* Alertes et notifications */
    .alert-modern {
        border: none;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--shadow-light);
        border-left: 5px solid;
    }

    .alert-success-modern {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border-left-color: var(--success-color);
    }

    .alert-warning-modern {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border-left-color: var(--warning-color);
    }

    .alert-danger-modern {
        background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
        border-left-color: var(--danger-color);
    }

    /* Widgets d'information */
    .info-widget {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: var(--shadow-light);
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .info-widget:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-medium);
    }

    .info-widget-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }

    .info-widget-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.5rem;
        color: white;
    }

    /* Responsive design amélioré */
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .nav-tabs-modern .nav-link {
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
        }

        .profile-header {
            text-align: center;
        }

        .patient-title::before {
            display: none;
        }
    }

    /* Éléments interactifs */
    .interactive-element {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .interactive-element:hover {
        transform: scale(1.02);
    }

    /* Loading states */
    .loading {
        position: relative;
        overflow: hidden;
    }

    .loading::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { left: -100%; }
        100% { left: 100%; }
    }
</style>

<div class="nk-content nk-content-fluid patient-dashboard">
    <div class="container-xl wide-lg">
        <div class="nk-content-body">

            <!-- En-tête du patient avec statistiques -->
            <div class="profile-header p-4 mb-4">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="d-flex align-items-center">
                            {% if patientsdetail.qr_code %}
                                <div class="qr-code-container mr-4">
                                    <img src="{{ patientsdetail.qr_code.url }}" width="120" alt="QR Code" class="img-fluid">
                                </div>
                            {% endif %}

                            <div class="flex-grow-1">
                                <h1 class="patient-title mb-2">
                                    {{ patientsdetail.nom }} {{ patientsdetail.prenoms }}
                                </h1>
                                <div class="patient-meta">
                                    <div class="d-flex flex-wrap align-items-center text-white-80">
                                        <span class="mr-3 mb-1">
                                            <i class="fas fa-id-badge mr-1"></i>
                                            <strong>{{ patientsdetail.code_patient }}</strong>
                                        </span>
                                        <span class="mr-3 mb-1">
                                            <i class="fas fa-{{ patientsdetail.genre|lower }} mr-1"></i>
                                            {{ patientsdetail.genre }}, {{ patientsdetail.calculate_age }} ans
                                        </span>
                                        <span class="mr-3 mb-1">
                                            <i class="fas fa-phone mr-1"></i>
                                            {{ patientsdetail.contact }}
                                        </span>
                                        <span class="mb-1">
                                            <i class="fas fa-tint mr-1 text-danger"></i>
                                            {{ patientsdetail.groupe_sanguin }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 text-lg-right">
                        <div class="patient-actions">
                            <button class="btn btn-light btn-modern mr-2 print-btn">
                                <i class="fas fa-print mr-1"></i> Imprimer
                            </button>
                            <a href="/" class="btn btn-light btn-modern back-btn">
                                <i class="fas fa-arrow-left mr-1"></i> Retour
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistiques en temps réel -->
            <div class="stats-grid">
                <div class="stat-card consultations">
                    <div class="stat-number">{{ consultations|length }}</div>
                    <div class="stat-label">Consultations</div>
                    <div class="stat-trend text-success">
                        <i class="fas fa-arrow-up mr-1"></i> 12% ce mois
                    </div>
                </div>
                <div class="stat-card hospitalizations">
                    <div class="stat-number">{{ hospitalizations|length }}</div>
                    <div class="stat-label">Hospitalisations</div>
                    <div class="stat-trend text-warning">
                        <i class="fas fa-minus mr-1"></i> Stable
                    </div>
                </div>
                <div class="stat-card appointments">
                    <div class="stat-number">{{ appointments|length }}</div>
                    <div class="stat-label">Rendez-vous</div>
                    <div class="stat-trend text-info">
                        <i class="fas fa-arrow-up mr-1"></i> 3 à venir
                    </div>
                </div>
                <div class="stat-card prescriptions">
                    <div class="stat-number">{{ prescriptions_count }}</div>
                    <div class="stat-label">Prescriptions</div>
                    <div class="stat-trend text-danger">
                        <i class="fas fa-clock mr-1"></i> 2 en cours
                    </div>
                </div>
            </div>

            <!-- Navigation par onglets améliorée -->
            <div class="nav-tabs-modern">
                <ul class="nav nav-tabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#tabOverview">
                            <i class="fas fa-chart-line mr-2"></i>Vue d'ensemble
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#tabPersonal">
                            <i class="fas fa-user mr-2"></i>Informations
                            <span class="badge">{{ personal_info_count }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#tabMedical">
                            <i class="fas fa-stethoscope mr-2"></i>Médical
                            <span class="badge">{{ medical_info_count }}</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#tabTimeline">
                            <i class="fas fa-history mr-2"></i>Historique
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#tabDocuments">
                            <i class="fas fa-folder mr-2"></i>Documents
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Contenu des onglets -->
            <div class="tab-content-modern">

                <!-- Onglet Vue d'ensemble -->
                <div class="tab-pane fade show active" id="tabOverview">
                    <div class="row">
                        <!-- Alertes importantes -->
                        <div class="col-12 mb-4">
                            <div class="alert alert-warning-modern">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-exclamation-triangle fa-2x mr-3 text-warning"></i>
                                    <div>
                                        <h5 class="alert-title mb-1">Alertes importantes</h5>
                                        <p class="mb-0">Allergie à la pénicilline notée. Prochain rendez-vous de suivi dans 3 jours.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Widgets rapides -->
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="info-widget interactive-element">
                                <div class="info-widget-header">
                                    <div class="info-widget-icon bg-primary">
                                        <i class="fas fa-heartbeat"></i>
                                    </div>
                                    <h6 class="mb-0">Constantes récentes</h6>
                                </div>
                                <div class="info-widget-body">
                                    <div class="vital-signs">
                                        <div class="vital-item d-flex justify-content-between mb-2">
                                            <span>TA:</span>
                                            <strong>120/80 mmHg</strong>
                                        </div>
                                        <div class="vital-item d-flex justify-content-between mb-2">
                                            <span>Temp:</span>
                                            <strong>36.8°C</strong>
                                        </div>
                                        <div class="vital-item d-flex justify-content-between">
                                            <span>SpO2:</span>
                                            <strong class="text-success">98%</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="info-widget interactive-element">
                                <div class="info-widget-header">
                                    <div class="info-widget-icon bg-success">
                                        <i class="fas fa-pills"></i>
                                    </div>
                                    <h6 class="mb-0">Traitements actuels</h6>
                                </div>
                                <div class="info-widget-body">
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-1">• Métformine 500mg</li>
                                        <li class="mb-1">• Lisinopril 10mg</li>
                                        <li>• Atorvastatine 20mg</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="info-widget interactive-element">
                                <div class="info-widget-header">
                                    <div class="info-widget-icon bg-warning">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <h6 class="mb-0">Prochain RDV</h6>
                                </div>
                                <div class="info-widget-body">
                                    <div class="text-center">
                                        <h4 class="text-primary mb-1">15 Mars</h4>
                                        <p class="mb-0 text-muted">10:30 AM</p>
                                        <small class="text-info">Dr. Diallo</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="info-widget interactive-element">
                                <div class="info-widget-header">
                                    <div class="info-widget-icon bg-danger">
                                        <i class="fas fa-exclamation-circle"></i>
                                    </div>
                                    <h6 class="mb-0">Alertes médicales</h6>
                                </div>
                                <div class="info-widget-body">
                                    <div class="text-center">
                                        <h4 class="text-danger mb-1">2</h4>
                                        <p class="mb-0">Alertes actives</p>
                                        <small class="text-muted">À surveiller</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Graphique de santé -->
                        <div class="col-12 mb-4">
                            <div class="medical-card">
                                <div class="medical-card-header">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-chart-line mr-2 text-primary"></i>
                                        Évolution des indicateurs de santé
                                    </h5>
                                </div>
                                <div class="medical-card-body">
                                    <div id="healthChart" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Onglet Informations personnelles (contenu similaire mais amélioré) -->
                <div class="tab-pane fade" id="tabPersonal">
                    <!-- Contenu amélioré de l'onglet informations personnelles -->
                </div>

                <!-- Onglet Médical -->
                <div class="tab-pane fade" id="tabMedical">
                    <!-- Contenu médical enrichi -->
                </div>

                <!-- Onglet Historique -->
                <div class="tab-pane fade" id="tabTimeline">
                    <div class="medical-timeline">
                        {% for event in timeline_events %}
                        <div class="timeline-item {{ event.type }}">
                            <div class="timeline-content medical-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="mb-0 text-primary">{{ event.title }}</h6>
                                    <small class="text-muted">{{ event.date|date:"d/m/Y" }}</small>
                                </div>
                                <p class="mb-2">{{ event.description }}</p>
                                {% if event.doctor %}
                                <small class="text-muted">
                                    <i class="fas fa-user-md mr-1"></i>{{ event.doctor }}
                                </small>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Onglet Documents -->
                <div class="tab-pane fade" id="tabDocuments">
                    <!-- Gestion des documents améliorée -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts améliorés -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialisation des composants
    initPatientDashboard();

    function initPatientDashboard() {
        // Animation au scroll
        initScrollAnimations();

        // Interactions des cartes
        initCardInteractions();

        // Graphiques
        initHealthCharts();

        // Gestion des onglets
        initTabAnimations();

        // Tooltips et popovers
        initTooltips();
    }

    function initScrollAnimations() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animation = 'fadeInUp 0.6s ease-out forwards';
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.medical-card, .stat-card, .info-widget').forEach(el => {
            observer.observe(el);
        });
    }

    function initCardInteractions() {
        // Hover effects
        document.querySelectorAll('.interactive-element').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Click animations
        document.querySelectorAll('.btn-modern').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Animation de clic
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });
    }

    function initHealthCharts() {
        // Exemple de graphique avec Chart.js ou ApexCharts
        if (typeof ApexCharts !== 'undefined') {
            const options = {
                series: [{
                    name: 'Tension systolique',
                    data: [120, 125, 118, 122, 119, 121, 123]
                }, {
                    name: 'Tension diastolique',
                    data: [80, 82, 78, 81, 79, 80, 82]
                }],
                chart: {
                    height: 300,
                    type: 'line',
                    zoom: {
                        enabled: false
                    },
                    toolbar: {
                        show: false
                    }
                },
                colors: ['#4a6cf7', '#dc3545'],
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                markers: {
                    size: 5,
                    hover: {
                        size: 7
                    }
                },
                xaxis: {
                    categories: ['01/03', '02/03', '03/03', '04/03', '05/03', '06/03', '07/03']
                },
                tooltip: {
                    theme: 'light'
                }
            };

            const chart = new ApexCharts(document.querySelector("#healthChart"), options);
            chart.render();
        }
    }

    function initTabAnimations() {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            const target = $(e.target).attr("href");
            $(target).addClass('animate__animated animate__fadeIn');

            // Réinitialiser l'animation pour la prochaine ouverture
            setTimeout(() => {
                $(target).removeClass('animate__animated animate__fadeIn');
            }, 500);
        });
    }

    function initTooltips() {
        $('[data-toggle="tooltip"]').tooltip({
            trigger: 'hover',
            placement: 'top',
            animation: true
        });
    }

    // Gestion de l'impression
    $('.print-btn').click(function() {
        $('.patient-dashboard').addClass('printing');
        window.print();
        setTimeout(() => {
            $('.patient-dashboard').removeClass('printing');
        }, 500);
    });

    // Simulation de données en temps réel
    function updateRealTimeStats() {
        // Cette fonction pourrait être connectée à des WebSockets
        // pour des mises à jour en temps réel
        setInterval(() => {
            // Mise à jour simulée des statistiques
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach(stat => {
                const current = parseInt(stat.textContent);
                const newValue = current + Math.floor(Math.random() * 2);
                animateValue(stat, current, newValue, 1000);
            });
        }, 30000); // Toutes les 30 secondes
    }

    function animateValue(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            element.innerHTML = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    // Démarrer les mises à jour en temps réel
    updateRealTimeStats();
});
</script>
{% endblock %}
{#{% extends 'layout/base.html' %}#}
{#{% load static %}#}
{#{% load humanize %}#}
{#{% block content %}#}
{#<div class="nk-content nk-content-fluid">#}
{##}
{#                    <div class="container-xl wide-lg">#}
{#                        <div class="nk-content-body">#}
{#                            <div class="nk-block-head nk-block-head-sm">#}
{#                                <div class="nk-block-between g-3">#}
{##}
{##}
{#                                    <div class="nk-block-head-content">#}
{#                                        {% if patientsdetail.qr_code %}#}
{#                                            <div class="nk-block float-left">#}
{#                                                <img src="{{ patientsdetail.qr_code.url }}" width="110" alt="QR Code">#}
{#                                            </div>#}
{#                                        {% else %}#}
{#                                            <p>Aucun QR code disponible pour ce patient.</p>#}
{#                                        {% endif %}#}
{#                                        <h3 class="nk-block-title page-title">Patient / <strong class="text-primary small">{{ patientsdetail.nom }} {{ patientsdetail.prenoms }}</strong></h3>#}
{#                                        <div class="nk-block-des text-soft ml-5">#}
{#                                            <ul class="list-inline">#}
{#                                                <li>UUID: <span class="text-base">{{ patientsdetail.code_patient }}</span></li>#}
{#                                                <li>CODE VIH: <span class="text-base">{% if patientsdetail.code_vih %} {{ patientsdetail.code_vih }}{% else %} NEANT {% endif %}</span></li>#}
{#                                                 <li>Derniere Visite: <span class="text-base">15 Feb, 2019 01:02 PM</span></li>#}
{#                                            </ul>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                    <div class="nk-block-head-content">#}
{#                                        <a href="/" class="btn btn-outline-light bg-secondary-dim d-none d-sm-inline-flex mr-5"><em class="icon ni ni-printer-fill"></em><span>Imprimer</span></a>#}
{#                                        <a href="/" class="btn btn-outline-light bg-white d-none d-sm-inline-flex"><em class="icon ni ni-arrow-left"></em><span>Back</span></a>#}
{#                                        <a href="#" class="btn btn-icon btn-outline-light bg-white d-inline-flex d-sm-none"><em class="icon ni ni-arrow-left"></em></a>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div><!-- .nk-block-head -->#}
{#                            <div class="nk-block">#}
{#                                      debut du nav#}
{#                                <ul class="nav nav-tabs nav-tabs-mb-icon nav-tabs-card">#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link active" data-toggle="tab" href="#tabItem0"><em#}
{#                                                class="icon ni ni-user-circle"></em><span>Personnel</span></a>#}
{#                                    </li>#}
{#                                    {% for service in patientsdetail.services_passed %}#}
{#                                        <li class="nav-item">#}
{#                                            <a class="nav-link" data-toggle="tab" href="#tabItem{{ service.id }}"><em#}
{#                                                    class="icon ni ni-repeat"></em><span>{{ service.nom }}</span></a>#}
{#                                        </li>#}
{##}
{#                                    {% endfor %}#}
{#                                    <li class="nav-item nav-item-trigger d-xxl-none">#}
{#                                        <a href="#" class="toggle btn btn-icon btn-trigger" data-target="userAside"><em#}
{#                                                class="icon ni ni-user-list-fill"></em></a>#}
{#                                    </li>#}
{# </ul>#}
{##}
{##}
{#                                <!-- .nav-tabs -->#}
{#                                <ul class="nav nav-tabs nav-tabs-mb-icon nav-tabs-card">#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link active" data-toggle="tab" href="#tabPersonal">#}
{#                                            <em class="icon ni ni-user"></em><span>Personal Infos</span>#}
{#                                        </a>#}
{#                                    </li>#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link " data-toggle="tab" href="#tabConsultations">#}
{#                                            <em class="icon ni ni-repeat"></em><span>Consultations</span>#}
{#                                        </a>#}
{#                                    </li>#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link" data-toggle="tab" href="#tabHospitalizations">#}
{#                                            <em class="icon ni ni-home"></em><span>Hospitalisations</span>#}
{#                                        </a>#}
{#                                    </li>#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link" data-toggle="tab" href="#tabAppointments">#}
{#                                            <em class="icon ni ni-calendar"></em><span>Rendez-vous</span>#}
{#                                        </a>#}
{#                                    </li>#}
{#                                    <li class="nav-item">#}
{#                                        <a class="nav-link" data-toggle="tab" href="#tabSuivis">#}
{#                                            <em class="icon ni ni-user-check"></em><span>Suivis</span>#}
{#                                        </a>#}
{#                                    </li>#}
{#                                </ul>#}
{##}
{#                                <div class="tab-content">#}
{#                                    <!-- Tab Peronal Info -->#}
{#                                    <div class="tab-pane fade show active" id="tabPersonal">#}
{##}
{#                                      <div class="nk-block">#}
{#    <div class="nk-block-head">#}
{#        <h5 class="title">Personal Information</h5>#}
{#        <p>Informations relatives au patient.</p>#}
{#    </div>#}
{#    <!-- .nk-block-head -->#}
{#    <div class="profile-ud-list">#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Sexe</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.genre }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Nom & Prénom</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.nom }} {{ patientsdetail.prenoms }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Date de naissance</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.date_naissance }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Lieu de naissance</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.lieu_naissance }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Âge</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.calculate_age }} ans</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Code Patient</span>#}
{#                <span class="profile-ud-value text-primary"><i class="fa-solid fa-lock"></i> {{ patientsdetail.code_patient }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Contact</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.contact }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Email</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.adresse_mail }}</span>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    <!-- .profile-ud-list -->#}
{#</div>#}
{#<!-- .nk-block -->#}
{#<div class="nk-block">#}
{#    <div class="nk-block-head nk-block-head-line">#}
{#        <h6 class="title overline-title text-base">Informations Supplémentaires</h6>#}
{#    </div>#}
{#    <!-- .nk-block-head -->#}
{#    <div class="profile-ud-list">#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Groupe Sanguin</span>#}
{#                <span class="profile-ud-value"><i class="fa-solid fa-droplet text-danger"></i> {{ patientsdetail.groupe_sanguin }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Nationalité</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.nationalite }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Profession</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.profession }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Employeur</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.employeur }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Nombre d'enfants</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.nbr_enfants }} <i class="fa-solid fa-children text-black-50"></i></span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Situation Matrimoniale</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.situation_matrimoniale }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Niveau d'Étude</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.niveau_etude }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Ethnie</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.ethnie }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Localité</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.localite.nom }}</span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="profile-ud-item">#}
{#            <div class="profile-ud wider">#}
{#                <span class="profile-ud-label">Statut</span>#}
{#                <span class="profile-ud-value">{{ patientsdetail.status }}</span>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    <!-- .profile-ud-list -->#}
{#</div>#}
{#<!-- .nk-block -->#}
{##}
{#                                        <!-- .nk-block -->#}
{#                                        <div class="nk-divider divider md"></div>#}
{#                                        <div class="nk-block">#}
{#                                            <div class="nk-block-head nk-block-head-sm nk-block-between">#}
{#                                                <h5 class="title">Cas Contacts</h5>#}
{#                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalDefault">Ajouter contact</button>#}
{##}
{#                                                <div class="modal fade" tabindex="-1" id="modalDefault">#}
{#    <div class="modal-dialog" role="document">#}
{#        <div class="modal-content">#}
{#            <a href="#" class="close" data-dismiss="modal" aria-label="Close">#}
{#                <em class="icon ni ni-cross"></em>#}
{#            </a>#}
{#            <div class="modal-header">#}
{#                    <h5>Ajouter un Cas Contact pour {{ patient.nom }} {{ patient.prenoms }}</h5>#}
{#            </div>#}
{#            <div class="modal-body">#}
{#            <form id="casContactForm" method="post" action="{% url 'add_cas_contact' patient_id=patientsdetail.id %}">#}
{#                {% csrf_token %}#}
{#                {{ cascontactsForm.as_p }}#}
{#                <button type="submit" class="btn btn-primary">Enregistrer</button>#}
{#            </form>#}
{#            </div>#}
{#            <div class="modal-footer bg-light">#}
{#                <span class="sub-text">Modal Footer Text</span>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{#                                            </div><!-- .nk-block-head -->#}
{#                                            <div class="bq-note">#}
{#                                                <div class="bq-note-item">#}
{#                                                    <table class="table">#}
{#  <thead>#}
{#    <tr>#}
{#      <th>#</th>#}
{#      <th>Nom</th>#}
{#      <th>Prénom</th>#}
{#      <th>Téléphone</th>#}
{#      <th>Relation</th>#}
{#      <th>Fréquence de Contact</th>#}
{#      <th>Dernier contact</th>#}
{#      <th>SMS Sensibilisation</th>#}
{#      <th>Action</th>#}
{#    </tr>#}
{#  </thead>#}
{#  <tbody>#}
{#    {% for contact in case_contacts %}#}
{#    <tr>#}
{#      <th scope="row">{{ forloop.counter }}</th>#}
{#      <td>{{ contact.contact_person.split|first }}</td>#}
{#      <td>{{ contact.contact_person.split|last }}</td>#}
{#      <td>{{ contact.phone_number }}</td>#}
{#      <td>{{ contact.get_relationship_display }}</td>#}
{#      <td>{{ contact.get_contact_frequency_display }}</td>#}
{#      <td>{{ contact.date_contact|date:"d/m/Y" }}</td>#}
{#      <td>{% if contact.smsdepistage %}#}
{#          <span class="badge badge-success xs">Envoyer</span>#}
{#          {% else %}#}
{#         <span class="badge badge-danger xs">non envoyer</span>#}
{#          {% endif %}#}
{#      </td>#}
{#      <td><button class="btn btn-outline-secondary btn-xs">#}
{#          Notifier#}
{#      </button></td>#}
{#    </tr>#}
{#    {% empty %}#}
{#    <tr>#}
{#      <td colspan="7" class="text-center">Aucun cas contact enregistré.</td>#}
{#    </tr>#}
{#    {% endfor %}#}
{#  </tbody>#}
{#</table>#}
{#                                                            </div>#}
{##}
{#                                            </div><!-- .bq-note -->#}
{#                                        </div><!-- .nk-block -->#}
{#                                    </div>#}
{##}
{#                                    <!-- Tab Consultations -->#}
{#                                    <div class="tab-pane fade" id="tabConsultations">#}
{##}
{#                                        <div id="accordion" class="accordion">#}
{#                                            {% for consultation in consultations %}#}
{#                                                <div class="accordion-item">#}
{#                                                    <a href="#"#}
{#                                                       class="accordion-head bg-azure-dim {% if not forloop.first %}collapsed{% endif %}"#}
{#                                                       data-toggle="collapse"#}
{#                                                       data-target="#accordion-item-{{ consultation.id }}">#}
{#                                                        <h6 data-toggle="tooltip" data-placement="left"#}
{#                                                            title="{{ consultation.consultation_date|naturaltime }}"#}
{#                                                            class="title">#}
{#                                                            Consultation du {{ consultation.consultation_date }}#}
{#                                                            | {{ consultation.reason|truncatewords:25 }}#}
{#                                                        </h6>#}
{#                                                        <span class="accordion-icon"></span>#}
{#                                                    </a>#}
{#                                                    <div class="accordion-body collapse {% if forloop.first %}show{% endif %}"#}
{#                                                         id="accordion-item-{{ consultation.id }}"#}
{#                                                         data-parent="#accordion">#}
{#                                                        <div class="accordion-inner">#}
{#                                                            <h5>Détails de la Consultation {{ consultation.num }}</h5>#}
{##}
{#                                                            <p><strong>Date#}
{#                                                                :</strong> {{ consultation.consultation_date|date:"d/m/Y H:i" }}#}
{#                                                            </p>#}
{#                                                            <p><strong>Raison#}
{#                                                                :</strong> {{ consultation.reason|default:"Non spécifiée" }}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Constante :</strong>#}
{#                                                                {% if consultation.constante %}#}
{#                                                                    {{ consultation.constante }}#}
{#                                                                {% else %}#}
{#                                                                    Aucune constante enregistrée.#}
{#                                                                {% endif %}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Examens :</strong>#}
{#                                                                {% if consultation.examens %}#}
{#                                                                    {{ consultation.examens }}#}
{#                                                                {% else %}#}
{#                                                                    Aucun examen associé.#}
{#                                                                {% endif %}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Symptômes :</strong></p>#}
{#                                                            <ul>#}
{#                                                                {% for symptome in consultation.symptomes.all %}#}
{#                                                                    <li>{{ symptome.nom }}</li>#}
{#                                                                {% empty %}#}
{#                                                                    <li>Aucun symptôme enregistré.</li>#}
{#                                                                {% endfor %}#}
{#                                                            </ul>#}
{##}
{#                                                            <p><strong>Antécédents Médicaux :</strong></p>#}
{#                                                            <ul>#}
{#                                                                {% for antecedent in consultation.antecedentsMedicaux.all %}#}
{#                                                                    <li>{{ antecedent.nom }}</li>#}
{#                                                                {% empty %}#}
{#                                                                    <li>Aucun antécédent médical.</li>#}
{#                                                                {% endfor %}#}
{#                                                            </ul>#}
{##}
{#                                                            <p><strong>Allergies :</strong></p>#}
{#                                                            <ul>#}
{#                                                                {% for allergie in consultation.allergies.all %}#}
{#                                                                    <li>{{ allergie.titre }}</li>#}
{#                                                                {% empty %}#}
{#                                                                    <li>Aucune allergie enregistrée.</li>#}
{#                                                                {% endfor %}#}
{#                                                            </ul>#}
{##}
{#                                                            <p><strong>Diagnostic :</strong></p>#}
{#                                                            <div>#}
{#                                                                {{ consultation.diagnosis|safe }}#}
{#                                                            </div>#}
{##}
{#                                                            <p><strong>Commentaires :</strong></p>#}
{#                                                            <div>#}
{#                                                                {{ consultation.commentaires|safe }}#}
{#                                                            </div>#}
{##}
{#                                                            <p><strong>Médecin :</strong>#}
{#                                                                {% if consultation.doctor %}#}
{#                                                                    {{ consultation.doctor.username }}#}
{#                                                                {% else %}#}
{#                                                                    Non attribué.#}
{#                                                                {% endif %}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Status#}
{#                                                                :</strong> {{ consultation.get_status_display|default:"Non défini" }}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Service de Suivi :</strong>#}
{#                                                                {% if consultation.suivi %}#}
{#                                                                    {{ consultation.suivi.nom }}#}
{#                                                                {% else %}#}
{#                                                                    Aucun service de suivi.#}
{#                                                                {% endif %}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Créé par :</strong>#}
{#                                                                {% if consultation.created_by %}#}
{#                                                                    {{ consultation.created_by.username }}#}
{#                                                                {% else %}#}
{#                                                                    Créateur inconnu.#}
{#                                                                {% endif %}#}
{#                                                            </p>#}
{##}
{#                                                            <p><strong>Créé le#}
{#                                                                :</strong> {{ consultation.created_at|date:"d/m/Y H:i" }}#}
{#                                                            </p>#}
{#                                                            <p><strong>Mis à jour le#}
{#                                                                :</strong> {{ consultation.updated_at|date:"d/m/Y H:i" }}#}
{#                                                            </p>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                            {% empty %}#}
{#                                                <p>Aucune consultation disponible pour ce patient.</p>#}
{#                                            {% endfor %}#}
{#                                        </div>#}
{##}
{##}
{#                                    </div>#}
{##}
{#                                    <!-- Tab Hospitalisations -->#}
{#                                    <div class="tab-pane fade" id="tabHospitalizations">#}
{#                                        <div id="accordion-hospitalization" class="accordion">#}
{#                                            {% for hospitalization in hospitalizations %}#}
{#                                                <div class="accordion-item">#}
{#                                                    <a href="#" class="bg-danger-dim accordion-head {% if not forloop.first %}collapsed{% endif %}" data-toggle="collapse" data-target="#accordion-item-hosp-{{ hospitalization.id }}">#}
{#                                                        <h6 class="title">#}
{#                                                            Hospitalisation#}
{#                                                            du {{ hospitalization.admission_date|date:"d/m/Y" }}#}
{#                                                            | Chambre#}
{#                                                            : {{ hospitalization.bed }}-{{ hospitalization.bed.box }}#}
{#                                                            | {% if hospitalization.discharge_date %}#}
{#                                                            <span class="badge badge-outline-primary"> Sortie le :#}
{#                                                            {{ hospitalization.discharge_date|date:"d/m/Y" }} | Motif :#}
{#                                                            {{ hospitalization.discharge_reason }} {% endif %}</span>#}
{#                                                        </h6>#}
{#                                                        <span class="accordion-icon"></span>#}
{#                                                    </a>#}
{#                                                    <div class="accordion-body collapse {% if forloop.first %}show{% endif %}"#}
{#                                                         id="accordion-item-hosp-{{ hospitalization.id }}"#}
{#                                                         data-parent="#accordion-hospitalization">#}
{#                                                        <div class="accordion-inner">#}
{#                                                            <!-- Détails de l'Hospitalisation -->#}
{#                                    <h6>Détails de l'Hospitalisation</h6>#}
{#                                    <p><strong>Chambre :</strong> {{ hospitalization.bed }}</p>#}
{#                                    <p><strong>Médecin Responsable :</strong> {{ hospitalization.doctor.username|default:"Non attribué" }}</p>#}
{#                                    <p><strong>Motif d'Admission :</strong> {{ hospitalization.reason_for_admission }}</p>#}
{#                                    <p><strong>Statut :</strong> {{ hospitalization.get_status_display|default:"Non défini" }}</p>#}
{##}
{#                                    <!-- Indicateurs -->#}
{#                                    <h6 class="mt-4">Indicateurs</h6>#}
{#                                    <p><strong>Biologiques :</strong></p>#}
{#                                    <ul>#}
{#                                        {% for indicator in hospitalization.indicateurs_biologiques.all %}#}
{#                                            <li>Globules Blancs : {{ indicator.globules_blancs }} | CRP : {{ indicator.crp }}</li>#}
{#                                        {% empty %}#}
{#                                            <li>Aucun indicateur biologique enregistré.</li>#}
{#                                        {% endfor %}#}
{#                                    </ul>#}
{##}
{#                                    <p><strong>Fonctionnels :</strong></p>#}
{#                                    <ul>#}
{#                                        {% for indicator in hospitalization.indicateurs_fonctionnels.all %}#}
{#                                            <li>Mobilité : {{ indicator.mobilite }} | Conscience : {{ indicator.conscience }}</li>#}
{#                                        {% empty %}#}
{#                                            <li>Aucun indicateur fonctionnel enregistré.</li>#}
{#                                        {% endfor %}#}
{#                                    </ul>#}
{##}
{#                                    <p><strong>Subjectifs :</strong></p>#}
{#                                    <ul>#}
{#                                        {% for indicator in hospitalization.indicateurs_subjectifs.all %}#}
{#                                            <li>Bien-Être : {{ indicator.bien_etre }}</li>#}
{#                                        {% empty %}#}
{#                                            <li>Aucun indicateur subjectif enregistré.</li>#}
{#                                        {% endfor %}#}
{#                                    </ul>#}
{##}
{#                                    <!-- Médicaments Prescrits -->#}
{#                                    <h6 class="mt-4">Médicaments Prescrits</h6>#}
{#                                    <ul>#}
{#                                        {% for prescription in hospitalization.hospiprescriptions.all %}#}
{#                                            <li>#}
{#                                                <strong>{{ prescription.medication.nom }}</strong> - {{ prescription.quantity }} unité(s)#}
{#                                                ({{ prescription.posology }})#}
{#                                            </li>#}
{#                                        {% empty %}#}
{#                                            <li>Aucune prescription pour cette hospitalisation.</li>#}
{#                                        {% endfor %}#}
{#                                    </ul>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                </div>#}
{#                                            {% empty %}#}
{#                                                <p>Aucune hospitalisation disponible pour ce patient.</p>#}
{#                                            {% endfor %}#}
{#                                        </div>#}
{#                                    </div>#}
{#                                    <!-- Tab Rendez-vous -->#}
{#                                    <div class="tab-pane fade" id="tabAppointments">#}
{#                                        <h5>Rendez-vous</h5>#}
{#                                        <ul>#}
{#                                            {% for appointment in appointments %}#}
{#                                                <li>#}
{#                                                    {{ appointment.date }} à {{ appointment.time }} -#}
{#                                                    {{ appointment.reason }} ({{ appointment.status }})#}
{#                                                </li>#}
{#                                            {% empty %}#}
{#                                                <p>Aucun rendez-vous disponible.</p>#}
{#                                            {% endfor %}#}
{#                                        </ul>#}
{#                                    </div>#}
{##}
{#                                    <!-- Tab Suivis -->#}
{#                                    <div class="tab-pane fade" id="tabSuivis">#}
{#                                        <h5>Suivis</h5>#}
{#                                        <ul>#}
{#                                            {% for suivi in suivis %}#}
{#                                                <li>#}
{#                                                    Activité : {{ suivi.activite.nom }} -#}
{#                                                    Service : {{ suivi.services.nom }}#}
{#                                                </li>#}
{#                                            {% empty %}#}
{#                                                <p>Aucun suivi disponible.</p>#}
{#                                            {% endfor %}#}
{#                                        </ul>#}
{#                                    </div>#}
{#                                </div>#}
{##}
{##}
{##}
{#   {% for service, consultations in services_with_consultations %}#}
{#    <div class="tab-pane" id="tabItem{{ service.id }}">#}
{#        {% if consultations %}#}
{#            {% for consultation in consultations %}#}
{#                <div>#}
{#                    <h5>Consultation {{ consultation.id }}</h5>#}
{#                    <div>#}
{#                        <strong>Constante:</strong> {{ consultation.constante }}<br>#}
{#                        <strong>Examens:</strong> {{ consultation.examens }}<br>#}
{#                        <strong>Symptômes:</strong>#}
{#                        <ul>#}
{#                            {% for symptome in consultation.symptomes.all %}#}
{#                                <li>{{ symptome.nom }}</li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                        <strong>Antécédents Médicaux:</strong>#}
{#                        <ul>#}
{#                            {% for antecedent in consultation.antecedentsMedicaux.all %}#}
{#                                <li>{{ antecedent.nom }}</li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                        <strong>Allergies:</strong>#}
{#                        <ul>#}
{#                            {% for allergie in consultation.allergies.all %}#}
{#                                <li>{{ allergie.titre }}</li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                        <strong>Docteur:</strong> {{ consultation.doctor }}<br>#}
{#                        <strong>Date de Consultation:</strong> {{ consultation.consultation_date }}<br>#}
{#                        <strong>Raison:</strong> {{ consultation.reason }}<br>#}
{#                        <strong>Diagnostic:</strong> {{ consultation.diagnosis }}<br>#}
{#                        <strong>Commentaires:</strong> {{ consultation.commentaires }}<br>#}
{#                        <strong>Statut:</strong> {{ consultation.status }}<br>#}
{#                        <strong>Hospitalisé:</strong> {{ consultation.hospitalised }}<br>#}
{#                        <strong>Créé par:</strong> {{ consultation.created_by }}<br>#}
{#                        <strong>Créé le:</strong> {{ consultation.created_at }}<br>#}
{#                        <strong>Mis à jour le:</strong> {{ consultation.updated_at }}<br>#}
{#                    </div>#}
{#                </div>#}
{#            {% endfor %}#}
{#        {% else %}#}
{#            <p>Aucune consultation pour ce service.</p>#}
{#        {% endif %}#}
{#    </div>#}
{#{% endfor %}#}
{##}
{##}
{#                                    {% for service, consultations in services_with_consultations %}#}
{#                                        <div class="tab-pane" id="tabItem{{ service.id }}">#}
{#                                            <h4>{{ service.nom }}</h4>#}
{#                                            {% if consultations %}#}
{#                                                {% for consultation in consultations %}#}
{#                                                    <div>#}
{#                                                        <h5>Consultation {{ consultation.id }}</h5>#}
{#                                                        <p>Constante: {{ consultation.constante }}</p>#}
{#                                                        <p>Examens: {{ consultation.examens }}</p>#}
{#                                                        <p>Symptômes:</p>#}
{#                                                        <ul>#}
{#                                                            {% for symptome in consultation.symptomes.all %}#}
{#                                                                <li>{{ symptome.nom }}</li>#}
{#                                                            {% endfor %}#}
{#                                                        </ul>#}
{#                                                        <p>Antécédents Médicaux:</p>#}
{#                                                        <ul>#}
{#                                                            {% for antecedent in consultation.antecedentsMedicaux.all %}#}
{#                                                                <li>{{ antecedent.nom }}</li>#}
{#                                                            {% endfor %}#}
{#                                                        </ul>#}
{#                                                        <p>Allergies:</p>#}
{#                                                        <ul>#}
{#                                                            {% for allergie in consultation.allergies.all %}#}
{#                                                                <li>{{ allergie.titre }}</li>#}
{#                                                            {% endfor %}#}
{#                                                        </ul>#}
{#                                                    </div>#}
{#                                                {% endfor %}#}
{#                                            {% else %}#}
{#                                                <p>Aucune consultation pour ce service.</p>#}
{#                                            {% endif %}#}
{#                                        </div>#}
{#                                    {% endfor %}#}
{##}
{#                                </div>#}
{#                            </div>#}
{#                            <!-- .card-aside-wrap -->#}
{#                        </div><!-- .card -->#}
{#                            </div><!-- .nk-block -->#}
{##}
{#    <script>#}
{#        document.getElementById('casContactForm').addEventListener('submit', function (e) {#}
{#            e.preventDefault();#}
{#            const formData = new FormData(this);#}
{##}
{#            fetch(this.action, {#}
{#                method: 'POST',#}
{#                body: formData,#}
{#                headers: {#}
{#                    'X-Requested-With': 'XMLHttpRequest'#}
{#                }#}
{#            })#}
{#                .then(response => response.json())#}
{#                .then(data => {#}
{#                    if (data.success) {#}
{#                        alert(data.message);#}
{#                        location.reload();  // Recharge la page ou redirige si nécessaire#}
{#                    } else if (data.errors) {#}
{#                        let errorMessages = Object.values(data.errors).map(err => err.join(' ')).join('\n');#}
{#                        alert("Erreur :\n" + errorMessages);#}
{#                    }#}
{#                })#}
{#                .catch(error => console.error('Erreur:', error));#}
{#        });#}
{#    </script>#}
{#{% endblock %}#}